# NATRO APACHE CONFIGURATION
# Next.js uygulaması için reverse proxy ayarları

<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # SSL yönlendirmesi (opsiyonel - SSL varsa açın)
    # RewriteCond %{HTTPS} !=on
    # RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]
    
    # www yönlendirmesi (opsiyonel)
    # RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
    # RewriteRule ^(.*)$ https://%1/$1 [R=301,L]
</IfModule>

<IfModule mod_proxy.c>
    ProxyRequests Off
    ProxyPreserveHost On
    
    # WebSocket desteği
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://localhost:3000/$1" [P,L]
    
    # Next.js static dosyaları
    ProxyPass /_next http://localhost:3000/_next
    ProxyPassReverse /_next http://localhost:3000/_next
    
    # Public klasörü
    ProxyPass /public http://localhost:3000/public
    ProxyPassReverse /public http://localhost:3000/public
    
    # API routes
    ProxyPass /api http://localhost:3000/api
    ProxyPassReverse /api http://localhost:3000/api
    
    # Ana uygulama
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
</IfModule>

# Güvenlik başlıkları
<IfModule mod_headers.c>
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-Content-Type-Options "nosniff"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Gzip sıkıştırma
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# Cache kontrolü
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Resimler
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
    
    # CSS ve JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    
    # Fontlar
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType font/otf "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"
</IfModule>

# Hata sayfaları
ErrorDocument 404 /404
ErrorDocument 500 /500

# Dosya erişim engelleme
<FilesMatch "\.(env|json|lock|md|gitignore|git|yml|yaml)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# .env dosyalarını koru
<Files ~ "^\.env">
    Order allow,deny
    Deny from all
</Files>

# Dizin listelemeyi kapat
Options -Indexes
